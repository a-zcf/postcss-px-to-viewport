webpackJsonp([2],{JXTs:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("mvHQ"),s=n.n(i),o={name:"index",data:function(){return{headImg02:n("l5cD"),bgk:"http://res.thewm.cn/zlbean//uploadpath/goodimage/86dcae6a985c48e4ab3e06eca103b4f7_bg0.png",inforText:"",list:[],hisMsgList:[],websock:null,id:"",headimgurl:"",type:1,show:!1,img:[],imgIdex:[],inx:"0"}},mounted:function(){this.id=this.$route.query.id,this.headimgurl=this.$route.query.headimgurl},created:function(){this.initWebSocket(),window.addEventListener("resize",function(){"INPUT"!==document.activeElement.tagName&&"TEXTAREA"!==document.activeElement.tagName||window.setTimeout(function(){document.activeElement.scrollIntoViewIfNeeded()},0)})},methods:{clickImg:function(t){this.show=!0;for(var e=0;e<this.imgIdex.length;e++)this.imgIdex[e]===t&&(this.inx=e)},blur:function(t){var e=t.currentTarget;setTimeout(function(){e.scrollIntoView({block:"end",behavior:"smooth"})},100)},focus:function(t){var e=this.$refs["infor-box"];e.scrollTop=e.scrollHeight;var n=t.currentTarget;setTimeout(function(){n.scrollIntoView({block:"end",behavior:"smooth"})},100)},clickFasong:function(){var t=this;t.type=2,""!=t.inforText&&(t.wsonopen(),t.list.push({state:"1",headImg:t.headimgurl,text:t.inforText}),setTimeout(function(){t.scrollBottm()},100),t.inforText="")},initWebSocket:function(){if("WebSocket"in window){this.websock=new WebSocket("ws://211.159.184.84:58080/webSocket"),this.websock.onopen=this.wsonopen,this.websock.onerror=this.wsonerror,this.websock.onmessage=this.wsonmessage,this.websock.onclose=this.wsclose}else alert("您的浏览器不支持 WebSocket!")},wsonopen:function(){if(1===this.type){var t={uid:this.id,msg:"comein"};1===this.websock.readyState&&this.websock.send(s()(t))}else{var e={uid:this.id,msg:this.inforText};1===this.websock.readyState&&this.websock.send(s()(e))}},wsonerror:function(){console.log("连接错误")},wsonmessage:function(t){var e=this,n=JSON.parse(t.data),i=n.hisMsgList;if(void 0!==i&&null!=i&&0!=i.length){for(var s=0;s<i.length;s++)"0"===i[s].type?this.list.push({state:"2",text:i[s].resMsg,code:i[s].code,url:i[s].url}):"1"===i[s].type&&(this.list.push({state:"1",text:i[s].userMsg,code:"00001",headImg:e.headimgurl}),this.list.push({state:"2",text:i[s].resMsg,code:i[s].code,url:i[s].url}));setTimeout(function(){e.scrollBottm()},100)}else this.list.push({state:"2",text:n.msg,code:n.code,url:n.url}),setTimeout(function(){e.scrollBottm()},100);for(var o=0;o<e.list.length;o++)"00003"===e.list[o].code&&(e.img.push(e.list[o].url),e.imgIdex.push(o))},wsclose:function(t){var e=this;1006==t.code&&(e.list=[],setTimeout(function(){e.initWebSocket()},1e3))},scrollBottm:function(){var t=this.$refs["infor-box"];t.scrollTop=t.scrollHeight},clickLingqu:function(){this.$router.push({path:"/receive"})}},destroyed:function(){this.websock.onclose=this.wsclose}},c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"index"},[n("img",{staticClass:"bgk",attrs:{src:t.bgk}}),t._v(" "),n("div",{ref:"infor-box",staticClass:"infor-box",attrs:{id:"infor-box"}},[n("ul",t._l(t.list,function(e,i){return n("li",{key:i,class:"1"==e.state?"my-info":"get-info"},[n("img",{class:"1"==e.state?"me-headimg":"get-headimg",attrs:{src:"1"==e.state?e.headImg:t.headImg02}}),t._v(" "),n("div",{class:"1"==e.state?"me-chatcontent":"get-chatcontent"},[n("van-image-preview",{attrs:{images:t.img,"start-position":t.inx,"show-index":!1},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}}),t._v(" "),"00003"===e.code?n("img",{staticClass:"urlImg",attrs:{src:e.url},on:{click:function(e){return t.clickImg(i)}}}):n("p",[n("span",{domProps:{innerHTML:t._s(e.text)}},[t._v(t._s(e.text))]),t._v(" "),n("br"),t._v(" "),"00000"===e.code?n("span",{staticClass:"click-lingqu",on:{click:t.clickLingqu}},[t._v("点击领取")]):t._e()])],1)])}),0)]),t._v(" "),n("div",{staticClass:"footer"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.inforText,expression:"inforText"}],attrs:{type:"text",placeholder:"请输入回复信息",id:"input"},domProps:{value:t.inforText},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.clickFasong(e)},blur:function(e){return e.preventDefault(),t.blur(e)},focus:t.focus,input:function(e){e.target.composing||(t.inforText=e.target.value)}}}),t._v(" "),n("button",{style:""==t.inforText?"background-color:#aeaeae;":"background-color:#03c;",on:{click:t.clickFasong}},[t._v("\n      发送\n    ")])])])};c._withStripped=!0;var a={render:c,staticRenderFns:[]},l=a;var r=!1;var h=n("VU/8")(o,l,!1,function(t){r||n("kqbP")},null,null);h.options.__file="src/views/index/index.vue";e.default=h.exports},kqbP:function(t,e,n){var i=n("oWqY");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);n("rjj0")("07532416",i,!1,{})},l5cD:function(t,e,n){t.exports=n.p+"static/img/headImg02.2ef3d8d.jpg"},oWqY:function(t,e,n){(t.exports=n("FZ+f")(!0)).push([t.i,"\n.viewer-footer {\n  display: none;\n}\n","",{version:3,sources:["F:/VSCode/yuan-xiao/src/views/index/src/views/index/index.vue"],names:[],mappings:";AA8QA;EACA,cAAA;CACA",file:"index.vue",sourcesContent:['<template>\n  <div class="index">\n    <img :src="bgk" class="bgk" />\n    <div class="infor-box" ref="infor-box" id="infor-box">\n      <ul>\n        <li\n          v-for="(item, index) in list"\n          :key="index"\n          :class="item.state == \'1\' ? \'my-info\' : \'get-info\'"\n        >\n          <img\n            :src="item.state == \'1\' ? item.headImg : headImg02"\n            :class="item.state == \'1\' ? \'me-headimg\' : \'get-headimg\'"\n          />\n          <div\n            :class="item.state == \'1\' ? \'me-chatcontent\' : \'get-chatcontent\'"\n          >\n            <van-image-preview\n              v-model="show"\n              :images="img"\n              :start-position="inx"\n              :show-index="false"\n            >\n            </van-image-preview>\n            <img\n              :src="item.url"\n              v-if="item.code === \'00003\'"\n              class="urlImg"\n              @click="clickImg(index)"\n            />\n            <p v-else>\n              <span v-html="item.text">{{ item.text }}</span>\n              <br />\n              <span\n                v-if="item.code === \'00000\'"\n                @click="clickLingqu"\n                class="click-lingqu"\n                >点击领取</span\n              >\n            </p>\n          </div>\n        </li>\n      </ul>\n    </div>\n    <div class="footer">\n      <input\n        type="text"\n        v-model="inforText"\n        @keyup.enter="clickFasong"\n        placeholder="请输入回复信息"\n        @blur.prevent="blur"\n        @focus="focus"\n        id="input"\n      />\n      <button\n        @click="clickFasong"\n        :style="\n          inforText == \'\'\n            ? \'background-color:#aeaeae;\'\n            : \'background-color:#03c;\'\n        "\n      >\n        发送\n      </button>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: "index",\n  data() {\n    return {\n      headImg02: require("../../assets/img/headImg02.jpg"),\n      bgk:\n        "http://res.thewm.cn/zlbean//uploadpath/goodimage/86dcae6a985c48e4ab3e06eca103b4f7_bg0.png",\n      inforText: "",\n      list: [],\n      hisMsgList: [],\n      websock: null,\n      id: "",\n      headimgurl: "",\n      type: 1,\n      show: false,\n      img: [],\n      imgIdex: [],\n      inx: "0",\n    };\n  },\n  mounted() {\n    let that = this;\n    that.id = this.$route.query.id;\n    that.headimgurl = this.$route.query.headimgurl;\n  },\n  created() {\n    let that = this;\n    this.initWebSocket();\n    window.addEventListener("resize", function () {\n      if (\n        document.activeElement.tagName === "INPUT" ||\n        document.activeElement.tagName === "TEXTAREA"\n      ) {\n        window.setTimeout(function () {\n          document.activeElement.scrollIntoViewIfNeeded();\n        }, 0);\n      }\n    });\n  },\n  methods: {\n    clickImg(index) {\n      this.show = true;\n      for (let i = 0; i < this.imgIdex.length; i++) {\n        if (this.imgIdex[i] === index) {\n          this.inx = i;\n        }\n      }\n    },\n    blur(event) {\n      let This = event.currentTarget;\n      setTimeout(() => {\n        This.scrollIntoView({\n          block: "end",\n          behavior: "smooth",\n        });\n      }, 100);\n    },\n    focus(event) {\n      let el = this.$refs["infor-box"];\n      el.scrollTop = el.scrollHeight;\n      let This = event.currentTarget;\n      setTimeout(() => {\n        This.scrollIntoView({\n          block: "end",\n          behavior: "smooth",\n        });\n      }, 100);\n    },\n    clickFasong() {\n      let that = this;\n      that.type = 2;\n      if (that.inforText == "") {\n        return;\n      }\n      that.wsonopen();\n      that.list.push({\n        state: "1",\n        headImg: that.headimgurl,\n        text: that.inforText,\n      });\n      setTimeout(() => {\n        that.scrollBottm();\n      }, 100);\n      that.inforText = "";\n    },\n    initWebSocket() {\n      let that = this;\n      if ("WebSocket" in window) {\n        let ws = "ws://211.159.184.84:58080/webSocket";\n        that.websock = new WebSocket(ws);\n        that.websock.onopen = that.wsonopen;\n        that.websock.onerror = that.wsonerror;\n        that.websock.onmessage = that.wsonmessage;\n        that.websock.onclose = that.wsclose;\n      } else {\n        alert("您的浏览器不支持 WebSocket!");\n      }\n    },\n    wsonopen: function () {\n      let that = this;\n      if (that.type === 1) {\n        let actions = {\n          uid: that.id,\n          msg: "comein",\n        };\n        if (this.websock.readyState === 1) {\n          this.websock.send(JSON.stringify(actions)); //连接建立之后执行send方法发送数据\n        } else {\n        }\n      } else {\n        let actions = {\n          uid: that.id,\n          msg: that.inforText,\n        };\n        if (this.websock.readyState === 1) {\n          this.websock.send(JSON.stringify(actions)); //连接建立之后执行send方法发送数据\n        } else {\n        }\n      }\n    },\n    wsonerror: function () {\n      console.log("连接错误");\n    },\n    wsonmessage: function (msg) {\n      let that = this;\n      let data = JSON.parse(msg.data);\n      let hisMsgList = data.hisMsgList;\n      if (\n        typeof hisMsgList != "undefined" &&\n        hisMsgList != null &&\n        hisMsgList.length != 0\n      ) {\n        for (let i = 0; i < hisMsgList.length; i++) {\n          if (hisMsgList[i].type === "0") {\n            this.list.push({\n              state: "2",\n              text: hisMsgList[i].resMsg,\n              code: hisMsgList[i].code,\n              url: hisMsgList[i].url,\n            });\n          } else if (hisMsgList[i].type === "1") {\n            this.list.push({\n              state: "1",\n              text: hisMsgList[i].userMsg,\n              code: "00001",\n              headImg: that.headimgurl,\n            });\n            this.list.push({\n              state: "2",\n              text: hisMsgList[i].resMsg,\n              code: hisMsgList[i].code,\n              url: hisMsgList[i].url,\n            });\n          }\n        }\n        setTimeout(() => {\n          that.scrollBottm();\n        }, 100);\n      } else {\n        this.list.push({\n          state: "2",\n          text: data.msg,\n          code: data.code,\n          url: data.url,\n        });\n        setTimeout(() => {\n          that.scrollBottm();\n        }, 100);\n      }\n      for (let i = 0; i < that.list.length; i++) {\n        if (that.list[i].code === "00003") {\n          that.img.push(that.list[i].url);\n          that.imgIdex.push(i);\n        }\n      }\n    },\n    wsclose: function (e) {\n      let that = this;\n      if (e.code == 1006) {\n        that.list = [];\n        setTimeout(function () {\n          that.initWebSocket();\n        }, 1000);\n      }\n    },\n    scrollBottm() {\n      let el = this.$refs["infor-box"];\n      el.scrollTop = el.scrollHeight;\n    },\n    clickLingqu() {\n      this.$router.push({ path: "/receive" });\n    },\n  },\n\n  destroyed() {\n    this.websock.onclose = this.wsclose; //离开路由之后断开websocket连接\n  },\n};\n<\/script>\n\n<style>\n.viewer-footer {\n  display: none;\n}\n</style>'],sourceRoot:""}])}});
//# sourceMappingURL=2.96ff80ddea74436a7c32.js.map